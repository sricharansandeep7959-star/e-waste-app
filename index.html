<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E-Waste Segregation Project</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
    }
    header {
      background: #2c7a7b;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .container {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }
    .card {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn {
      display: inline-block;
      padding: 10px 15px;
      margin: 5px 5px 5px 0;
      background: #2c7a7b;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
      border: none;
    }
    .btn:hover {
      background: #285e61;
    }
    .hidden {
      display: none;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }
    .image-box {
      border: 2px dashed #999;
      padding: 20px;
      text-align: center;
      color: #666;
      margin-bottom: 15px;
      cursor: pointer;
    }
    .image-box img {
      max-width: 150px;
      max-height: 150px;
      display: block;
      margin-top: 10px;
      border-radius: 5px;
    }
    .public-entry {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      background: #f9f9f9;
    }
    .public-entry img {
      max-width: 200px;
      max-height: 200px;
      display: block;
      margin-top: 5px;
      border-radius: 5px;
    }
    footer {
      background: #1a202c;
      color: white;
      text-align: center;
      padding: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<header>
  <h1>E-Waste Segregation System</h1>
  <p>College Mini Project</p>
</header>

<div class="container">
  <!-- Starting Modes -->
  <div class="card">
    <h2>Select Item Condition</h2>
    <button class="btn" onclick="showWorking()">Working</button>
    <button class="btn" onclick="showNonWorking()">Non-Working</button>
  </div>

  <!-- Working Items -->
  <div id="working" class="card hidden">
    <h2>Working Items</h2>
    <button class="btn" onclick="showInfo('Working Keyboard')">Keyboard</button>
    <button class="btn" onclick="showInfo('Working Mouse')">Mouse</button>
    <button class="btn" onclick="showInfo('Working Motherboard')">Motherboard</button>
    <button class="btn" onclick="showInfo('Working RAM')">RAM</button>
  </div>

  <!-- Non Working Items -->
  <div id="nonworking" class="card hidden">
    <h2>Non-Working Items</h2>
    <button class="btn" onclick="showInfo('Non-Working Keyboard')">Keyboard</button>
    <button class="btn" onclick="showInfo('Non-Working Mouse')">Mouse</button>
    <button class="btn" onclick="showInfo('Non-Working Motherboard')">Motherboard</button>
    <button class="btn" onclick="showInfo('Non-Working RAM')">RAM</button>
  </div>

  <!-- Editable Information Section -->
  <div id="info" class="card hidden">
    <h2 id="infoTitle"></h2>

    <label><strong>College Name</strong></label>
    <input type="text" id="college" placeholder="Enter college name">

    <label><strong>Location</strong></label>
    <input type="text" id="location" placeholder="Enter location">
<label><strong>Contact Number</strong></label>
<input 
  type="text" 
  id="contact"
  placeholder="Enter contact number"
  oninput="this.value = this.value.replace(/[^0-9]/g, '')">

    <label><strong>Upload Image</strong></label>
    <div class="image-box" id="imageBox">
      Drag & Drop Image Here or Click to Upload
      <input type="file" id="imageInput" accept="image/*" style="display:none;">
    </div>

    <label><strong>Your Content</strong></label>
    <textarea id="content" placeholder="Write your information here..."></textarea>

    <button class="btn" onclick="saveData()">Save</button>
  </div>

  <!-- Public View Section -->
  <div id="public" class="card">
    <h2>Public Saved Data (View Only)</h2>
    <button class="btn" onclick="clearData()">Clear All Data</button>
    <div id="publicData"></div>
  </div>
</div>

<footer>
  <p>Developed by Eco Experts | E-Waste Project</p>
</footer>

<script>
let selectedImageData = "";

// Load saved data safely
window.onload = function() {
  try {
    const savedData = localStorage.getItem('publicData');
    if(savedData) {
      document.getElementById('publicData').innerHTML = savedData;
    }
  } catch(e) {
    console.error("Error loading saved data:", e);
    localStorage.removeItem('publicData'); // reset corrupted data
  }
}

// Show/hide working & non-working
function showWorking() {
  document.getElementById('working').classList.remove('hidden');
  document.getElementById('nonworking').classList.add('hidden');
  document.getElementById('info').classList.add('hidden');
}

function showNonWorking() {
  document.getElementById('nonworking').classList.remove('hidden');
  document.getElementById('working').classList.add('hidden');
  document.getElementById('info').classList.add('hidden');
}

function showInfo(title) {
  document.getElementById('infoTitle').innerText = title;
  document.getElementById('info').classList.remove('hidden');
}

// Image drag & click handling
const imageBox = document.getElementById('imageBox');
const imageInput = document.getElementById('imageInput');

imageBox.addEventListener('click', () => imageInput.click());
imageBox.addEventListener('dragover', (e) => { e.preventDefault(); imageBox.style.background = "#e2f0f0"; });
imageBox.addEventListener('dragleave', () => { imageBox.style.background = ""; });
imageBox.addEventListener('drop', (e) => { e.preventDefault(); imageBox.style.background = ""; handleImage(e.dataTransfer.files[0]); });
imageInput.addEventListener('change', (e) => { handleImage(e.target.files[0]); });

// Resize image for storage (small thumbnail)
function handleImage(file) {
  if(file && file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.src = e.target.result;
      img.onload = function() {
        const canvas = document.createElement("canvas");
        const maxSize = 200; // max width or height
        let width = img.width;
        let height = img.height;

        if(width > height) {
          if(width > maxSize) { height *= maxSize/width; width = maxSize; }
        } else {
          if(height > maxSize) { width *= maxSize/height; height = maxSize; }
        }

        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, width, height);
        selectedImageData = canvas.toDataURL("image/png");
        imageBox.innerHTML = "<img src='" + selectedImageData + "' alt='Uploaded Image'>";
      }
    }
    reader.readAsDataURL(file);
  } else {
    alert("Please select a valid image file.");
  }
}

// Save data with date/time and thumbnail image
function saveData() {
  const title = document.getElementById('infoTitle').innerText;
  const college = document.getElementById('college').value;
  const location = document.getElementById('location').value;
  const content = document.getElementById('content').value;

  if(title === "" || content === "") {
    alert("Please select an item and enter your content!");
    return;
  }

  const now = new Date();
  const dateTime = now.toLocaleString();

  const imageTag = selectedImageData ? "<img src='" + selectedImageData + "' alt='Uploaded Image'>" : "";

  const entryHTML =
    "<div class='public-entry'>" +
    "<strong>Title:</strong> " + title + "<br>" +
    "<strong>College:</strong> " + college + "<br>" +
    "<strong>Location:</strong> " + location + "<br>" +
    "<strong>Date:</strong> " + dateTime + "<br>" +
    imageTag + "<br>" +
    "<pre>" + content + "</pre>" +
    "</div>";

  const publicBox = document.getElementById('publicData');
  publicBox.innerHTML += entryHTML;

  // Save safely to localStorage
  try {
    localStorage.setItem('publicData', publicBox.innerHTML);
  } catch(e) {
    alert("Image is too large to save in localStorage. Try a smaller image.");
    console.error(e);
  }

  // Reset inputs
  document.getElementById('college').value = "";
  document.getElementById('location').value = "";
  document.getElementById('content').value = "";
  selectedImageData = "";
  imageBox.innerHTML = "Drag & Drop Image Here or Click to Upload";

  alert('Data saved and displayed below (persists even after refresh)');
}

// Clear all data
function clearData() {
  if(confirm("Are you sure you want to clear all saved data?")) {
    document.getElementById('publicData').innerHTML = "";
    localStorage.removeItem('publicData');
  }
}
</script>
</body>
</html>